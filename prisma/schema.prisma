generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
}
enum UserRole {
  PLAYER
  ORGANIZER
  ADMIN
}

enum TournamentFormat {
  SOLO
  TEAM
}

enum TournamentStatus {
  DRAFT
  OPEN
  ONGOING
  COMPLETED
  CANCELED
}

enum RegistrationStatus {
  PENDING
  CONFIRMED
  REJECTED
  WITHDRAWN
}

model User {
  id                   Int            @id @default(autoincrement())
  email                String         @unique
  username             String         @unique
  password             String
  role                 UserRole       @default(PLAYER)
  teamId               Int?
  createdAt            DateTime       @default(now())
  updatedAt            DateTime       @updatedAt
  registrations        Registration[]
  captainOf            Team[]         @relation("TeamCaptain")
  organizedTournaments Tournament[]   @relation("Organizer")
  team                 Team?          @relation("TeamMembers", fields: [teamId], references: [id])
}

model Tournament {
  id              Int              @id @default(autoincrement())
  name            String
  game            String
  format          TournamentFormat
  maxParticipants Int
  prizePool       Float
  startDate       DateTime
  endDate         DateTime
  status          TournamentStatus @default(DRAFT)
  organizerId     Int
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  registrations   Registration[]
  organizer       User             @relation("Organizer", fields: [organizerId], references: [id])
}

model Team {
  id            Int            @id @default(autoincrement())
  name          String         @unique
  tag           String         @unique
  captainId     Int
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  registrations Registration[]
  captain       User           @relation("TeamCaptain", fields: [captainId], references: [id])
  members       User[]         @relation("TeamMembers")
}

model Registration {
  id           Int                @id @default(autoincrement())
  tournamentId Int
  playerId     Int?
  teamId       Int?
  status       RegistrationStatus @default(PENDING)
  registeredAt DateTime           @default(now())
  confirmedAt  DateTime?
  team         Team?              @relation(fields: [teamId], references: [id])
  player       User?              @relation(fields: [playerId], references: [id])
  tournament   Tournament         @relation(fields: [tournamentId], references: [id])

  @@index([tournamentId])
}


