<%- include('../../partials/head', { title: 'Liste des reservations' }) %>

<body class="bg-gray-100 min-h-screen flex flex-col">
  <%- include('../../partials/header') %>

  <main class="container mx-auto py-8 px-4 grow">
    <div class="flex justify-between items-center mb-8">
      <h1 class="text-3xl font-bold text-gray-800">Liste des reservations</h1>
      <% if (user) { %>
        <a href="/bookings/new" class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg inline-flex items-center gap-2 transition-colors">
          <%- icon('Plus', { size: 20 }) %>
          Nouvelle reservation
        </a>
      <% } %>
    </div>

    <div class="bg-white rounded-lg shadow overflow-hidden">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Station</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Utilisateur</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Debut</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fin</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut</th>
            <% if (user) { %>
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            <% } %>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <% bookings.forEach(booking => { %>
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium text-gray-900"><%= booking.station.name %></div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-900"><%= booking.user.username %></div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-900"><%= new Date(booking.startTime).toLocaleString('fr-FR') %></div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-900"><%= new Date(booking.endTime).toLocaleString('fr-FR') %></div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="px-3 py-1 rounded-full text-xs font-medium
                  <%= booking.status === 'confirmed' ? 'bg-green-100 text-green-800' :
                      booking.status === 'cancelled' ? 'bg-red-100 text-red-800' :
                      'bg-gray-100 text-gray-800' %>">
                  <%= booking.status === 'confirmed' ? 'Confirmee' :
                      booking.status === 'cancelled' ? 'Annulee' : 'Terminee' %>
                </span>
              </td>
              <% if (user) { %>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                  <div class="flex justify-end gap-2">
                    <a href="/bookings/<%= booking.id %>/edit" class="text-gray-500 hover:text-blue-500" title="Modifier">
                      <%- icon('Pencil', { size: 18 }) %>
                    </a>
                    <button type="button" onclick="openDeleteModal(<%= booking.id %>, this, '/bookings')" data-name="<%= booking.station.name %> - <%= booking.user.username %>" class="text-gray-500 hover:text-red-500 cursor-pointer" title="Supprimer">
                      <%- icon('Trash2', { size: 18 }) %>
                    </button>
                  </div>
                </td>
              <% } %>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>

    <% if (bookings.length === 0) { %>
      <div class="text-center py-12">
        <p class="text-gray-500 text-lg">Aucune reservation pour le moment.</p>
        <% if (user) { %>
          <a href="/bookings/new" class="inline-block mt-4 text-blue-500 hover:text-blue-700">
            Creer une reservation
          </a>
        <% } %>
      </div>
    <% } %>
  </main>

  <%- include('../../partials/deleteModal', { itemType: 'la reservation' }) %>

  <%- include('../../partials/footer') %>
</body>
</html>
